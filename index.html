<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Tattoo Preview</title>
  <!-- Cropper.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
  <style>
    body { font-family: sans-serif; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; background:#f9f9f9; color:#333; }
    .container { width:100%; max-width:480px; padding:1rem; position:relative; }
    .cropper-container .cropper-view-box, .cropper-container .cropper-face { border:3px solid #4A90E2; }
    .image-wrapper { margin:1rem auto; width:80%; max-height:40vh; overflow:hidden; }
    /* Result image retains proportions */
    #resultPage .image-wrapper { max-height:none; overflow:visible; }
    #resultPage .image-wrapper img { max-width:100%; max-height:60vh; width:auto; height:auto; display:block; margin:0 auto; }
    .suggestions { display:flex; flex-wrap:wrap; gap:0.5rem; margin:0.5rem 0; }
    .suggestions button { background:#eee; border:none; border-radius:0.25rem; padding:0.25rem 0.5rem; cursor:pointer; }
    .hidden { display:none; }
    button.primary { background:#4A90E2; color:#fff; border:none; padding:0.75rem 1rem; border-radius:0.25rem; width:100%; cursor:pointer; margin-top:0.5rem; }
    .artists-grid { display:flex; flex-wrap:wrap; gap:1rem; margin-top:1rem; }
    .artist-card { width:48%; background:#fff; border:1px solid #ddd; border-radius:0.25rem; overflow:hidden; cursor:pointer; }
    .artist-card img { width:100%; height:auto; }
    .artist-card .info { padding:0.5rem; font-size:0.9rem; }
    .drawer { position:fixed; top:0; right:0; height:100%; width:80%; max-width:320px; background:#fff; box-shadow:-2px 0 8px rgba(0,0,0,0.2); transform:translateX(100%); transition:transform 0.3s ease; z-index:2000; display:flex; flex-direction:column; }
    .drawer.active { transform:translateX(0); }
    .drawer-header { padding:1rem; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
    .drawer-content { padding:1rem; flex:1; overflow-y:auto; }
    .artist-desc { margin-top:1rem; font-size:0.9rem; color:#555; }
    .portfolio { margin-top:1rem; }
    .portfolio h3 { margin-bottom:0.5rem; font-size:1rem; }
    .portfolio-grid { display:flex; flex-wrap:wrap; gap:0.5rem; }
    .portfolio-grid img { width:48%; border-radius:0.25rem; }
    #loadingOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; color:#fff; font-size:1.2rem; backdrop-filter:blur(2px); opacity:0; pointer-events:none; flex-direction:column; transition:opacity 0.3s; }
    #loadingOverlay.active { opacity:1; pointer-events:all; }
    .spinner { border:4px solid rgba(255,255,255,0.3); border-top:4px solid #fff; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin-bottom:1rem; }
    @keyframes spin { to { transform:rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container" id="uploadPage">
    <h1>AI Tattoo Preview</h1>
    <p>Upload a photo of your body part and select where to preview a tattoo.</p>
    <input type="file" id="fileInput" accept="image/*">
    <div class="image-wrapper hidden" id="imageWrapper">
      <img id="uploadedImage" alt="Upload preview">
    </div>
    <div class="suggestions hidden" id="suggestions">
      <button data-token=", super realistic">super realistic</button>
      <button data-token=", black & white">B&amp;W</button>
      <button data-token=", fine line">fine line</button>
      <button data-token=", minimalistic">minimalistic</button>
    </div>
    <textarea id="promptInput" class="hidden" rows="2" placeholder="Describe your tattoo..."></textarea>
    <button id="submitBtn" class="primary hidden">Generate Preview</button>
  </div>

  <div class="container hidden" id="resultPage">
    <h1>Your Tattoo Preview</h1>
    <div class="image-wrapper">
      <img id="resultImage" alt="Tattoo result">
    </div>
    <button id="downloadBtn" class="primary">Download</button>
    <button id="remixBtn" class="primary">Remix</button>
    <div class="artists-grid" id="artistsGrid"></div>
  </div>

  <div class="drawer" id="artistDrawer">
    <div class="drawer-header">
      <h2 id="drawerName">Artist</h2>
      <button id="drawerClose">✕</button>
    </div>
    <div class="drawer-content" id="drawerContent"></div>
  </div>

  <div id="loadingOverlay">
    <div class="spinner"></div>
    <div>Working on your design…</div>
  </div>

  <!-- Cropper.js JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <script>
    let usageCount = 0;
    const MAX_FREE = 5;
    const artistsData = [
      {id:1,name:'Artist A',rating:3,location:'Austin, TX',image:'https://via.placeholder.com/150',specialty:'Tribal',likes:120,portfolio:['https://via.placeholder.com/100','https://via.placeholder.com/100'], contact:{whatsapp:'15551234567',email:'a@artist.com'}},
      {id:2,name:'Artist B',rating:4,location:'Miami, FL',image:'https://via.placeholder.com/150',specialty:'Fine Line',likes:250,portfolio:['https://via.placeholder.com/100','https://via.placeholder.com/100'], contact:{whatsapp:'15557654321',email:'b@artist.com'}},
      {id:3,name:'Artist C',rating:2,location:'Seattle, WA',image:'https://via.placeholder.com/150',specialty:'Color Work',likes:80,portfolio:['https://via.placeholder.com/100','https://via.placeholder.com/100'], contact:{whatsapp:'15559876543',email:'c@artist.com'}},
    ];

    const fileInput = document.getElementById('fileInput');
    const img = document.getElementById('uploadedImage');
    const wrapper = document.getElementById('imageWrapper');
    const promptInput = document.getElementById('promptInput');
    const suggestions = document.getElementById('suggestions');
    const submitBtn = document.getElementById('submitBtn');
    const uploadPage = document.getElementById('uploadPage');
    const resultPage = document.getElementById('resultPage');
    const resultImage = document.getElementById('resultImage');
    const downloadBtn = document.getElementById('downloadBtn');
    const remixBtn = document.getElementById('remixBtn');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const artistsGrid = document.getElementById('artistsGrid');
    const drawer = document.getElementById('artistDrawer');
    const drawerName = document.getElementById('drawerName');
    const drawerContent = document.getElementById('drawerContent');
    const drawerClose = document.getElementById('drawerClose');

    let cropper;

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (!file) return;
      if (cropper) { cropper.destroy(); cropper = null; }
      wrapper.classList.add('hidden');promptInput.classList.add('hidden');suggestions.classList.add('hidden');submitBtn.classList.add('hidden');
      img.onload = () => {
        wrapper.classList.remove('hidden');promptInput.classList.remove('hidden');suggestions.classList.remove('hidden');submitBtn.classList.remove('hidden');
        cropper = new Cropper(img,{viewMode:1,dragMode:'crop',autoCropArea:0.7,movable:true,zoomable:true,cropBoxMovable:true,cropBoxResizable:true,responsive:true});
        const cont = cropper.container; if(cont) cont.style.touchAction='none';
      };
      img.src = URL.createObjectURL(file);
    });

    function showArtists() {
      artistsGrid.innerHTML = '';
      artistsData.forEach(a => {
        const card = document.createElement('div');card.className='artist-card';
        card.innerHTML = `<img src="${a.image}" alt="${a.name}"><div class="info"><strong>${a.name}</strong><br>Rating: ${'⭐'.repeat(a.rating)}<br>${a.location}</div>`;
        card.addEventListener('click',() => openDrawer(a));artistsGrid.appendChild(card);
      });
    }

    function openDrawer(a) {
      drawerName.textContent = a.name;
      drawerContent.innerHTML = `<img src="${a.image}" style="width:100%;border-radius:0.25rem;"><p><strong>Specialty:</strong> ${a.specialty}</p><p><strong>Location:</strong> ${a.location}</p><p><strong>Likes:</strong> ${a.likes}</p><div class="artist-desc">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin sit amet tristique urna.</div><div class="portfolio"><h3>Portfolio</h3><div class="portfolio-grid">${a.portfolio.map(src=>`<img src="${src}" alt="Portfolio">`).join('')}</div></div><div id="messageArea" style="margin-top:1rem;"><textarea id="artistMsg" rows="3" placeholder="Type your message..."></textarea><button id="sendMsgBtn" class="primary">Send Message</button></div>`;
      document.getElementById('sendMsgBtn').addEventListener('click',() => {
        const msg = document.getElementById('artistMsg').value.trim();if(!msg) return alert('Please enter a message.');alert('Message sent: '+msg);document.getElementById('artistMsg').value='';
      });
      drawer.classList.add('active');
    }

    drawerClose.addEventListener('click',()=>drawer.classList.remove('active'));

    function showResultStub() {loadingOverlay.classList.remove('active');uploadPage.classList.add('hidden');resultPage.classList.remove('hidden');resultImage.src=img.src;showArtists();}
    function enforceUsage(){usageCount++;return usageCount<=MAX_FREE;}
    submitBtn.addEventListener('click',()=>{if(!enforceUsage()){alert('Please register to continue.');return;}loadingOverlay.classList.add('active');setTimeout(showResultStub,2000);});
    remixBtn.addEventListener('click',()=>{if(!enforceUsage()){alert('Please register to continue.');return;}uploadPage.classList.remove('hidden');resultPage.classList.add('hidden');drawer.classList.remove('active');});
    suggestions.querySelectorAll('button').forEach(btn=>btn.addEventListener('click',()=>{promptInput.value+=btn.dataset.token;}));
    downloadBtn.addEventListener('click',()=>{if(resultImage.src){const a=document.createElement('a');a.href=resultImage.src;a.download='tattoo-preview.jpg';a.click();}});
  </script>
</body>
</html>
